!function(e,t){for(var s in t)e[s]=t[s]}(exports,function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=8)}([function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("child_process")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),r=s(2),o=s(0);let i;t.getWSLExecutablePath=function(){let e=function(){const e=/(\d+)\.(\d+)\.(\d+)/g.exec(r.release());let t=0;return e&&4===e.length&&(t=parseInt(e[3])),t}()>=16299;const t=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432"),s=process.env.SystemRoot;if(s)return n.join(s,t?"Sysnative":"System32",e?"wsl.exe":"bash.exe")},t.getProductConfiguration=function(e){if(!i){const t=o.readFileSync(n.join(e,"product.json")).toString();i=JSON.parse(t)}return i}},,,,function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(9),r=s(3),o=s(0),i=s(4),c=process.env.VSCODE_WSL_AGENT_DEBUG_PORT,a=process.env.VSCODE_WSL_PIPE_NAME,l=parseInt(process.env.VSCODE_WSL_EXT_HOST_PID||"0",10),u=process.env.VSCODE_WSL_EXT_LOCATION,d=process.env.VSCODE_WSL_APP_ROOT,h=process.env.VSCODE_WSL_ENABLE_TELEMETRY||!1;class f{constructor(e,t){this.increment=e,this.message=t,this.type="progressMessage"}}t.ProgressMessage=f;class p{constructor(e){this.data=e,this.type="stdoutMessage"}}t.StdoutMessage=p;class g{constructor(e){this.data=e,this.type="stderrMessage"}}t.StderrMessage=g;class _{constructor(e,t){this.ipAddresses=e,this.port=t,this.type="portResolved"}}t.PortResolvedMessage=_;class S{constructor(e){this.message=e,this.type="fatalErrorOccured"}}t.FatalErrorOccuredMessage=S;let y=null,v=[];function w(e){for(let t=0;t<v.length;t++)v[t]===e&&v.splice(t,1);0===v.length&&process.exit(0)}!function(){const e=new class{send(e){process.stdout.write(JSON.stringify(e)+"\n")}};v.push(e);let t=setInterval(function(){try{process.kill(l,0)}catch(s){clearInterval(t),w(e)}},1e3)}();const L=n.createServer(e=>{const t=new E(e),s=new class{send(e){t.send(e)}};v.push(s),t.onMessage=(()=>{throw new Error("Received unexpected message")}),y&&s.send(y),e.on("close",()=>{w(s)})});function m(e){e&&"EADDRINUSE"===e.code||(console.error(e),process.exit(0));let t=e=>{console.error(e),process.exit(0)},s=n.createConnection(a,()=>{s.removeListener("error",t),new E(s).onMessage=(e=>{b(e)}),s.on("close",()=>{process.exit(0)})});s.once("error",t)}function b(e){v.forEach(t=>{t.send(e)})}L.on("error",m),L.listen(a,()=>{let e;L.removeListener("error",m);let t="",s=0,n="",a=[];const l=t=>{clearTimeout(e),b(y=new S(t))},v=()=>{let r=!1;if(O)O=!1,C=0,M&&(b(new f(0,"Installing WSL components")),M=!1);else if(++C>300)return void l(`VS Code Server for WSL failed to start. No messages received for ${Math.floor(90)}s`);return w.length&&(b(new p(w)),r=(r=>{for(let s=0;s<r.length;s++){const n=r.charCodeAt(s);if(10===n){const s=t.match(/Extension host agent listening on (\d+)/);if(s)return clearTimeout(e),b(y=new _(a,parseInt(s[1],10))),!0;const n=t.match(/IP Address: ([\d\.]+)/);n&&a.push(n[1]),t=""}else 8===n?t=t.substr(0,t.length-1):t+=r.charAt(s)}const o=t.match(/(\d+)%$/);let i=0;if(o){const e=Math.min(parseInt(o[1],10),100);e>s&&(i=e-s,s=e)}return(n!==t||i>0)&&(n=t,b(new f(i,t))),!1})(w),w=""),E.length&&(b(new g(E)),E=""),r};let w="",E="",O=!1,C=0,M=!0;e=setInterval(v,300);const P=i.getWSLExecutablePath();if(!P||!o.existsSync(P))return void l(`VS Code Server for WSL failed. '${P}' not found.\n\nMake sure WSL is installed:\nhttps://aka.ms/vscode-remote/wsl/install-wsl`);const{commit:x,quality:k}=i.getProductConfiguration(d);if(x&&!k)return void l(`VSCode Client (${d}) does not define a quality.`);const I=c?`--inspect=0.0.0.0:${c}`:"",W=x?`"./scripts/wslServer.sh ${x} ${k} .vscode-remote ${I} ${h?"":"--disable-telemetry"}"`:`"./scripts/wslServer-dev.sh '${d}' ${I}"`,$=P.endsWith("wsl.exe")?["bash","-i","-c",W]:["-i","-c",W];b(new p(`Launching ${P} ${$.join(" ")} in ${u}`));const T=r.spawn(P,$,{cwd:u,windowsVerbatimArguments:!0});T.stdout.on("data",e=>{w+=e.toString(),O=!0}),T.stderr.on("data",e=>{E+=e.toString(),O=!0}),T.on("error",e=>{v()||l(`VS Code Server for WSL failed with error:\r\n${e.message}`)}),T.on("close",e=>{v()||l("VS Code Server for WSL closed unexpectedly.")})});class E{constructor(e){this.onMessage=null,this.onClose=null,this._byteProtocol=new O(e),this._byteProtocol.onClose=(()=>{this.onClose&&this.onClose()}),this._byteProtocol.onMessage=(e=>{if(!this.onMessage)throw new Error("Incorrect usage!");this.onMessage(JSON.parse(e.toString()))})}send(e){this._byteProtocol.send(Buffer.from(JSON.stringify(e)))}}t.SimpleProtocol=E;class O{constructor(e){this._socket=e,this._writeBuffer=new class{constructor(){this._data=[],this._totalLength=0}add(e,t){const s=0===this._totalLength;return this._data.push(e,t),this._totalLength+=e.length+t.length,s}take(){const e=Buffer.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,e}},this._chunks=[],this.onMessage=null,this.onClose=null;let t=0;const s={readHead:!0,bodyLen:-1};this._socketDataListener=(e=>{for(this._chunks.push(e),t+=e.length;t>0;){if(s.readHead){if(!(t>=O._headerLen))break;{const e=Buffer.concat(this._chunks);s.bodyLen=e.readUInt32BE(0),s.readHead=!1;const n=e.slice(O._headerLen);t=n.length,this._chunks=[n]}}if(!s.readHead){if(!(t>=s.bodyLen))break;{const e=Buffer.concat(this._chunks),n=e.slice(0,s.bodyLen),r=e.slice(s.bodyLen);if(t=r.length,this._chunks=[r],s.bodyLen=-1,s.readHead=!0,!this.onMessage)throw new Error("Incorrect usage!");this.onMessage(n)}}}}),e.on("data",this._socketDataListener),this._socketCloseListener=(()=>{this.onClose&&this.onClose()}),e.once("close",this._socketCloseListener)}send(e){const t=Buffer.allocUnsafe(O._headerLen);t.writeUInt32BE(e.length,0,!0),this._writeSoon(t,e)}_writeSoon(e,t){this._writeBuffer.add(e,t)&&setImmediate(()=>{this._socket.destroyed||this._socket.write(this._writeBuffer.take())})}}O._headerLen=4,t.ByteProtocol=O},function(e,t){e.exports=require("net")}]));
//# sourceMappingURL=wslDaemon.js.map